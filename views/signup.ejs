<!-- Wappler include head-page="layouts/main" fontawesome_5="cdn" bootstrap5="local" is="dmx-app" id="signup" appConnect="local" components="{dmxDataTraversal:{},dmxFormatter:{},dmxValidator:{}}" -->
<dmx-value id="status" dmx-bind:value="validarCNPJ.data.respostaStatus"></dmx-value>
<dmx-data-detail id="data_detail_plano_escolhido" dmx-bind:data="listagemPlanos.data.queryPlanos" key="id_plano"></dmx-data-detail>
<dmx-serverconnect id="listagemPlanos" url="/api/master/planos"></dmx-serverconnect>
<dmx-value id="currentStep" dmx-bind:value="1"></dmx-value>

<div class="min-vh-100 login-bg py-5">
    <div class="container">
        <div class="row justify-content-center">
            <div class="d-flex justify-content-center mb-5"><img class="img-fluid" src="/assets/images/spacefeed-white.png" width="200"></div>
            <div class="col-12 col-lg-8 col-xl-7 mb-4" dmx-show="status.value.isEmpty()">
                <form id="validarCNPJ" is="dmx-serverconnect-form" method="post" action="/api/master/validar-empresa" dmx-on:success="status.setValue(validarCNPJ.data.respostaStatus)">
                    <div class="card shadow-sm mb-4 rounded-4" dmx-show="currentStep.value === 1">
                        <div class="card-header bg-white py-3">
                            <h4 class="mb-0 text-black">Consulta CNPJ</h4>
                        </div>
                        <div class="card-body bg-light rounded-3">
                            <div class="row">
                                <div class="col">
                                    <div class="form-group mb-3"> <label for="nome_polo" class="form-label">CNPJ</label>
                                        <input type="text" class="form-control" id="validacnpj" name="validacnpj" required="" data-msg-required="Por favor, informe o CNPJ" pattern="^[0-9]{2}\.?[0-9]{3}\.?[0-9]{3}\/?[0-9]{4}\-?[0-9]{2}$" data-msg-pattern="Por favor, informe um CNPJ válido">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer bg-white text-end">
                            <button type="submit" class="btn btn-primary">Validar</button>
                        </div>
                    </div>
                </form>


            </div>
            <div class="col-12 col-lg-8 col-xl-7 mb-4" dmx-show="status.value==1">
                <section>
                    <div class="jumbotron text-light">
                        <h1 class="display-3">Seu pagamento ainda está sendo processado!</h1>
                        <p class="lead">Este CNPJ já está cadastrado em nossa plataforma e o pagamento da fatura está em fase de processamento.</p>
                        <hr class="my-4">
                        <p>Assim que a confirmação for concluída, sua conta será ativada automaticamente.
                        <p>Caso a confirmação demore mais de 1 dia útil, entre em contato com o suporte para verificar a situação.</p>
                        </p>
                        <p class="lead">
                            <a class="btn btn-primary btn-lg" href="#" role="button">Preciso de suporte!</a>
                        </p>
                    </div>
                </section>


            </div>
            <div class="col-12 col-lg-8 col-xl-7 mb-4" dmx-show="status.value==2">
                <section>
                    <div class="jumbotron text-light">
                        <h1 class="display-3">Esta empresa já está ativa!</h1>
                        <p class="lead">Este CNPJ já está cadastrado em nossa plataforma com status ativo.
                        <p>Caso você precise acessar a conta, utilize a opção de login. Se tiver dificuldades, entre em contato com o suporte.</p>
                        </p>
                        <hr class="my-4">
                        <p class="lead">
                            <a class="btn btn-primary btn-lg" href="#" role="button">Preciso de suporte!</a>
                        </p>
                    </div>
                </section>


            </div>
            <div class="col-12 col-lg-8 col-xl-7 mb-4" dmx-show="status.value==3">
                <section>
                    <div class="jumbotron text-light">
                        <h1 class="display-3">Esta empresa está inativa!</h1>
                        <p class="lead">Este CNPJ já está cadastrado em nossa plataforma, mas encontra-se com status inativo.</p>
                        <hr class="my-4">
                        <p>Para reativar a conta ou obter mais informações, entre em contato com o suporte.</p>
                        <p class="lead">
                            <a class="btn btn-primary btn-lg" href="#" role="button">Preciso de suporte!</a>
                        </p>
                    </div>
                </section>


            </div>


            <div class="col-12 col-lg-8 col-xl-7" dmx-show="status.value==4">

                <!-- Progress Bar -->

                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div class="step-item d-flex align-items-center">
                        <div class="step-circle" dmx-class:active="currentStep.value >= 1">1</div>
                        <span class="step-label" dmx-class:active="currentStep.value >= 1">Empresa</span>
                    </div>
                    <div class="flex-grow-1 px-3">
                        <div class="progress">
                            <div class="progress-bar bg-white" dmx-class:w-100="currentStep.value >= 2"></div>
                        </div>
                    </div>
                    <div class="step-item d-flex align-items-center">
                        <div class="step-circle" dmx-class:active="currentStep.value >= 2">2</div>
                        <span class="step-label" dmx-class:active="currentStep.value >= 2">Endereço</span>
                    </div>
                    <div class="flex-grow-1 px-3">
                        <div class="progress">
                            <div class="progress-bar bg-white" dmx-class:w-100="currentStep.value >= 3"></div>
                        </div>
                    </div>
                    <div class="step-item d-flex align-items-center">
                        <div class="step-circle" dmx-class:active="currentStep.value >= 3">3</div>
                        <span class="step-label" dmx-class:active="currentStep.value >= 3">Usuário</span>
                    </div>
                    <div class="flex-grow-1 px-3">
                        <div class="progress">
                            <div class="progress-bar bg-white" dmx-class:w-100="currentStep.value >= 4"></div>
                        </div>
                    </div>
                    <div class="step-item d-flex align-items-center">
                        <div class="step-circle" dmx-class:active="currentStep.value >= 4">4</div>
                        <span class="step-label" dmx-class:active="currentStep.value >= 4">Plano</span>
                    </div>
                </div>

                <!-- Form -->
                <form id="cadastrarEmpresa" is="dmx-serverconnect-form" method="post" action="/api/master/signup" dmx-on:error="notifies1.danger('erro')" dmx-on:success="browser1.goto('/conta-criada')" dmx-on:invalid="notifies1.danger('Por favor, preencha todos os campos obrigatórios.')">
                    <!-- Step 1: Dados da Empresa -->
                    <div class="card shadow-sm mb-4 rounded-4" dmx-show="currentStep.value === 1">
                        <div class="card-header bg-white py-3">
                            <h4 class="mb-0 text-black">Dados da Empresa</h4>
                        </div>
                        <div class="card-body bg-light rounded-3">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group mb-3"> <label for="razao_social" class="form-label">Razão Social</label>
                                        <input type="text" class="form-control" id="razao_social" name="razao_social" required data-msg-required="Por favor, informe a Razão Social">
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="form-group mb-3"> <label for="nome_fantasia" class="form-label">Nome Fantasia</label>
                                        <input type="text" class="form-control" id="nome_fantasia" name="nome_fantasia" required data-msg-required="Por favor, informe o Nome Fantasia">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-5">
                                    <div class="form-group mb-3"> <label for="nome_polo" class="form-label">Nome do Polo</label>
                                        <input type="text" class="form-control" id="nome_polo" name="nome_polo" required data-msg-required="Por favor, informe o Nome do Polo">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group mb-3"> <label for="nome_polo" class="form-label">CNPJ</label>
                                        <input type="text" class="form-control" id="cnpj" name="cnpj" required data-msg-required="Por favor, informe o CNPJ" pattern="^[0-9]{2}\.?[0-9]{3}\.?[0-9]{3}\/?[0-9]{4}\-?[0-9]{2}$" data-msg-pattern="Por favor, informe um CNPJ válido">
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group mb-3"> <label for="whatsapp" class="form-label">Whatspp</label>
                                        <input type="text" class="form-control" id="whatsapp" name="whatsapp" required="" data-msg-required="Por favor, informe o WhatsApp" pattern="^\([0-9]{2}\) [0-9] [0-9]{4}\-[0-9]{4}$" data-msg-pattern="Por favor, informe um número de WhatsApp válido">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer bg-white text-end">
                            <button type="button" class="btn btn-primary" dmx-on:click="currentStep.setValue(2)">Próximo</button>
                        </div>
                    </div>

                    <!-- Step 2: Dados de Endereço -->
                    <div class="card shadow-sm mb-4 rounded-3" dmx-show="currentStep.value === 2">
                        <div class="card-header bg-white py-3">
                            <h4 class="mb-0 text-black">Dados de Endereço</h4>
                        </div>
                        <div class="card-body bg-light rounded-4">
                            <div class="row">
                                <div class="col-md-7">
                                    <div class="form-group mb-3"> <label for="logradouro" class="form-label">Logradouro</label>
                                        <input type="text" class="form-control" id="logradouro" name="logradouro" required data-msg-required="Por favor, informe o Logradouro">
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <div class="form-group mb-3"> <label for="numero" class="form-label">Número</label>
                                        <input type="text" class="form-control" id="numero" name="numero" required data-msg-required="Por favor, informe o Número">
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group mb-3"> <label for="cep" class="form-label">CEP</label>
                                        <input type="text" class="form-control" id="cep" name="cep" required="" data-msg-required="Por favor, informe o CEP" pattern="^[0-9]{5}\-[0-9]{3}$" data-msg-pattern="Por favor, informe um CEP válido">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-12">
                                    <div class="form-group mb-3"> <label for="complemento" class="form-label">Complemento</label>
                                        <input type="text" class="form-control" id="complemento" name="complemento" aria-describedby="input1_help3">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group mb-3"> <label for="bairro" class="form-label">Bairro</label>
                                        <input type="text" class="form-control" id="bairro" name="bairro" required data-msg-required="Por favor, informe o Bairro">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group mb-3"> <label for="cidade" class="form-label">Cidade</label>
                                        <input type="text" class="form-control" id="cidade" name="cidade" required data-msg-required="Por favor, informe a Cidade">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group mb-3"> <label for="nome_completo" class="form-label">Estado</label>
                                        <select id="estado" class="form-select" name="estado" required data-msg-required="Por favor, selecione um Estado">
                                            <option value="">Selecione um estado</option>
                                            <option value="AC">Acre</option>
                                            <option value="AL">Alagoas</option>
                                            <option value="AP">Amapá</option>
                                            <option value="AM">Amazonas</option>
                                            <option value="BA">Bahia</option>
                                            <option value="CE">Ceará</option>
                                            <option value="DF">Distrito Federal</option>
                                            <option value="ES">Espírito Santo</option>
                                            <option value="GO">Goiás</option>
                                            <option value="MA">Maranhão</option>
                                            <option value="MT">Mato Grosso</option>
                                            <option value="MS">Mato Grosso do Sul</option>
                                            <option value="MG">Minas Gerais</option>
                                            <option value="PA">Pará</option>
                                            <option value="PB">Paraíba</option>
                                            <option value="PR">Paraná</option>
                                            <option value="PE">Pernambuco</option>
                                            <option value="PI">Piauí</option>
                                            <option value="RJ">Rio de Janeiro</option>
                                            <option value="RN">Rio Grande do Norte</option>
                                            <option value="RS">Rio Grande do Sul</option>
                                            <option value="RO">Rondônia</option>
                                            <option value="RR">Roraima</option>
                                            <option value="SC">Santa Catarina</option>
                                            <option value="SP">São Paulo</option>
                                            <option value="SE">Sergipe</option>
                                            <option value="TO">Tocantins</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer bg-white">
                            <button type="button" class="btn btn-secondary" dmx-on:click="currentStep.setValue(1)">Anterior</button>
                            <button type="button" class="btn btn-primary float-end" dmx-on:click="currentStep.setValue(3)">Próximo</button>
                        </div>
                    </div>

                    <!-- Step 3: Dados do Usuário -->
                    <div class="card shadow-sm mb-4 rounded-3" dmx-show="currentStep.value === 3">
                        <div class="card-header bg-white py-3">
                            <h4 class="mb-0 text-black">Dados do Usuário</h4>
                        </div>
                        <div class="card-body bg-light  rounded-4">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group mb-3"> <label for="nome_completo" class="form-label">Nome Completo*</label>
                                        <input type="text" class="form-control" id="nome_completo" name="nome_completo" required="" data-msg-required="Por favor, informe o Nome Completo">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group mb-3"> <label for="nome_tratamento" class="form-label">Nome de Tratamento</label>
                                        <input type="text" class="form-control" id="nome_tratamento" name="nome_tratamento" required data-msg-required="Por favor, informe o Nome de Tratamento">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group mb-3"> <label for="email" class="form-label">E-mail*</label>
                                        <input type="email" class="form-control" id="email" name="email" required data-msg-required="Por favor, informe o E-mail" data-msg-email="Por favor, informe um e-mail válido">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group mb-3"> <label for="senha" class="form-label">Senha*</label>
                                        <input type="password" class="form-control" id="senha" name="senha" required data-msg-required="Por favor, informe uma Senha" minlength="8" data-msg-minlength="A senha deve ter no mínimo 8 caracteres">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group mb-3"> <label for="confirmar_senha" class="form-label">Confirmar Senha</label>
                                        <input type="password" class="form-control" id="confirmar_senha" name="confirmar_senha" required data-msg-required="Por favor, confirme a Senha" data-rule-equalto="#senha" data-msg-equalto="As senhas não conferem">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer bg-white">
                            <button type="button" class="btn btn-secondary" dmx-on:click="currentStep.setValue(2)">Anterior</button>
                            <button type="button" class="btn btn-primary float-end" dmx-on:click="currentStep.setValue(4)">Próximo</button>
                        </div>
                    </div>

                    <!-- Step 4: Escolha um plano -->
                    <div class="card shadow-sm mb-4 rounded-3" dmx-show="currentStep.value === 4">
                        <div class="card-header bg-white py-3">
                            <h4 class="mb-0 text-black">Escolha um plano</h4>
                        </div>
                        <div class="card-body bg-light  rounded-4">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group mb-3"> <label for="nome_completo1" class="form-label">Planos</label>
                                        <select id="planoEscolhido" class="form-select" dmx-bind:options="listagemPlanos.data.queryPlanos" optiontext="nome" optionvalue="id_plano" name="planoEscolhido" dmx-on:changed="data_detail_plano_escolhido.select(selectedValue)" required data-msg-required="Por favor, selecione um Plano">
                                            <option value="null">Selecione um plano</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group mb-3"> <label for="polosAdicionais" class="form-label">Polo Adicional</label>
                                        <input type="number" class="form-control" id="polosAdicionais" name="polosAdicionais" value="0" min="0" required data-msg-required="Por favor, informe a quantidade de Polos Adicionais" data-msg-min="O valor mínimo é 0">
                                    </div>
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <h6 class="m-0">Assinatura Mensal</h6>
                                        <div class="d-flex align-items-center gap-3">
                                            <input id="valorPlanoEscolhido" name="valorPlanoEscolhido" type="number" class="form-control" style="width: 120px;" step="0.01" dmx-bind:value="data_detail_plano_escolhido.data.valor_base" readonly="true">
                                        </div>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center mt-2">
                                        <h6 class="m-0">Polos Adicionais</h6>
                                        <div class="d-flex align-items-center gap-3">
                                            <input id="valorPolosAdicionais" name="valorPolosAdicionais" type="number" class="form-control" style="width: 120px;" value="0.00" min="0" step="0.01" dmx-bind:value="(data_detail_plano_escolhido.data.valor_polo_extra*polosAdicionais.value.toNumber()).toFixed(2)" readonly="true">
                                        </div>
                                    </div>
                                    <hr class="my-3">
                                    <div class="d-flex justify-content-between align-items-center bg-white p-3 rounded">
                                        <h4 class="m-0">Total Mensal</h4>
                                        <input id="valorTotal" name="valorTotal" type="number" class="form-control w-25" dmx-bind:value="valorPlanoEscolhido.value?(valorPlanoEscolhido.value.toNumber() + valorPolosAdicionais.value.toNumber()).toFixed(2):'0.00'" readonly="">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-12 mt-4">
                                    <button type="button" class="btn btn-secondary" dmx-on:click="currentStep.setValue(3)">Anterior</button>
                                    <button id="btn2" class="btn btn-primary px-5 float-end" type="button" dmx-on:click="cadastrarEmpresa.submit()">Finalizar Cadastro</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<style>
    /* Barra de progresso mais fina */
    .progress-bar {
        transition: width 0.3s ease-in-out;
    }

    .progress {
        height: 2px;
    }

    .rounded-circle {
        transition: all 0.3s ease;
    }

    /* Novo estilo para o progresso */
    .step-circle {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        border: 2px solid #fff;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #fff;
        background: transparent;
        transition: all 0.3s ease;
    }

    .step-circle.active {
        background: #fff;
        color: #000;
    }

    .step-label {
        margin-left: 0.5rem;
        color: rgba(255, 255, 255, 0.7);
        transition: all 0.3s ease;
    }

    .step-label.active {
        color: #fff;
    }

    .step-item {
        margin-top: -7px;
        /* Ajuste para alinhar com a linha fina */
    }
</style>

<meta name="ac:route" content="/signup">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.6.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.js"></script>

<script>
    $('#cep').mask('00000-000');
    $('#cnpj').mask('00.000.000/0000-00');
    $('#validacnpj').mask('00.000.000/0000-00');
    $('#whatsapp').mask('(00) 0 0000-0000');
</script>